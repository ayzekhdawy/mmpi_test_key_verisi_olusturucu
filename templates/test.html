<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMPI Kişilik Envanteri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .test-container { max-width: 700px; margin: 50px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .progress { height: 10px; margin-bottom: 30px; border-radius: 5px; }
        .question-text { font-size: 1.4rem; font-weight: 600; color: #333; margin-bottom: 30px; min-height: 80px; }
        .btn-option { width: 100%; margin-bottom: 15px; padding: 15px; font-size: 1.2rem; border: 2px solid #e9ecef; border-radius: 10px; transition: all 0.3s; text-align: left; }
        .btn-option:hover { border-color: #0d6efd; background-color: #f8f9fa; }
        .btn-option.selected { background-color: #0d6efd; color: white; border-color: #0d6efd; }
        .hidden { display: none; }
        .question-number { color: #888; font-size: 0.9rem; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="test-container">
        <div class="d-flex justify-content-between mb-2">
            <span id="progress-text">Soru 1 / {{ total }}</span>
            <span id="percentage">0%</span>
        </div>
        <div class="progress">
            <div id="progress-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
        </div>

        <form id="mmpiForm" action="/submit" method="POST">
            
            {% for q in questions %}
            <div class="question-slide {% if not loop.first %}hidden{% endif %}" data-index="{{ loop.index0 }}">
                <div class="question-number">SORU {{ q['Question #'] }}</div>
                <div class="question-text">{{ q['Question'] }}</div>
                
                <input type="radio" name="{{ q['Question #'] }}" value="Evet" id="q{{ q['Question #'] }}_yes" class="d-none">
                <button type="button" class="btn btn-option" onclick="selectOption(this, 'q{{ q['Question #'] }}_yes')">
                    Evet
                </button>

                <input type="radio" name="{{ q['Question #'] }}" value="Hayır" id="q{{ q['Question #'] }}_no" class="d-none">
                <button type="button" class="btn btn-option" onclick="selectOption(this, 'q{{ q['Question #'] }}_no')">
                    Hayır
                </button>
            </div>
            {% endfor %}

            <div id="finish-slide" class="hidden text-center">
                <h3>Test Tamamlandı!</h3>
                <p>Sonuçlarınızı analiz etmek için lütfen butona tıklayın.</p>
                <button type="submit" class="btn btn-success btn-lg mt-3">Sonuçları Göster</button>
            </div>

        </form>
    </div>
</div>

<script>
    let currentSlide = 0;
    const totalSlides = {{ total }};
    const slides = document.querySelectorAll('.question-slide');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const percentageText = document.getElementById('percentage');

    function selectOption(btn, inputId) {
        // 1. İlgili radio butonunu seçili yap
        document.getElementById(inputId).checked = true;

        // 2. Görsel efekti uygula
        const parent = btn.parentElement;
        const buttons = parent.querySelectorAll('.btn-option');
        buttons.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        // 3. Kısa bir gecikmeyle sonraki soruya geç (Akıcılık için)
        setTimeout(() => {
            nextQuestion();
        }, 200); // 200 milisaniye bekle
    }

    function nextQuestion() {
        // Şu anki soruyu gizle
        slides[currentSlide].classList.add('hidden');
        
        currentSlide++;

        if (currentSlide < totalSlides) {
            // Sonraki soruyu göster
            slides[currentSlide].classList.remove('hidden');
            
            // İlerleme çubuğunu güncelle
            const percent = Math.round((currentSlide / totalSlides) * 100);
            progressBar.style.width = percent + "%";
            progressText.innerText = `Soru ${currentSlide + 1} / ${totalSlides}`;
            percentageText.innerText = percent + "%";
        } else {
            // Test bitti, bitiş ekranını göster
            document.getElementById('finish-slide').classList.remove('hidden');
            progressBar.style.width = "100%";
            progressText.innerText = "Tamamlandı";
            percentageText.innerText = "100%";
        }
    }
</script>

</body>
</html>